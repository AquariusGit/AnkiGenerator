# Anki 卡片包產生器 - 使用說明書

歡迎使用 Anki 卡片包產生器！本工具旨在幫助您從喜愛的影片和字幕中，輕鬆、高效地建立包含音訊、截圖和原文的雙語 Anki 學習卡片。
程式碼基於商業友善的 Apache 開源協議，原始碼位址為 https://github.com/AquariusGit/AnkiGenerator。

## 目錄
- [軟體簡介](#軟體簡介)
- [主要功能](#主要功能)
- [系統要求](#系統要求)
- [初次使用](#初次使用)
- [介面概覽](#介面概覽)
- [使用步驟](#使用步驟)
  - [第一步：下載音訊/影片和字幕](#第一步下載音訊影片和字幕)
  - [第二步：產生 Anki 卡片包](#第二步產生-anki-卡片包)
  - [可選：從 CSV 檔案產生](#可選從-csv-檔案產生)
- [設定選項卡](#設定選項卡)
- [常見問題 (FAQ)](#常見問題-faq)

---

## 軟體簡介

本工具是一個圖形化介面的應用程式，可以從 YouTube 等影片網站下載影片/音訊和多語言字幕，並將其處理成可以匯入 Anki 的 `.apkg` 檔案。產生的卡片可以包含句子原文、譯文、對應的音訊片段、影片截圖，甚至為中日韓語言自動新增拼音/注音，極大地豐富了您的語言學習材料。

## 主要功能
- **影片下載**: 支援從 YouTube 等網站下載影片或純音訊。
- **字幕下載**: 自動取得並下載官方字幕和自動產生字幕。
- **雙語卡片**: 一鍵產生包含兩種語言字幕的 Anki 卡片。
- **音訊提取**: 自動從影片中截取每條字幕對應的音訊片段。
- **影片截圖**: 自動為每張卡片截取影片畫面。
- **TTS 支援**: 當沒有影片或音訊時，可使用 gTTS 或 Edge-TTS 為字幕產生語音。
- **自動注音**:
    - 為日文漢字自動新增假名 (Furigana)。
    - 為中文漢字自動新增拼音 (Pinyin)。
    - 為韓文自動新增羅馬音 (Romanization)。
- **高度可自訂**:
    - 自訂 Anki 卡片範本和樣式。
    - 調整字幕時間軸、合併字幕行。
    - 多種後期處理選項，如自動清理臨時檔案。
- **多語言介面**: 支援英語、簡繁中文、日語、韓語、越南語等多種介面語言。

## 系統要求
- **Python**: 需要安裝 Python 3.x 環境。
- **FFmpeg**: 必須安裝 **FFmpeg** 並將其新增到系統的環境變數 (PATH) 中。FFmpeg 用於從影片中提取音訊和截取螢幕截圖。如果未正確安裝，相關功能將無法使用。

## 初次使用
當您第一次執行本軟體時，會彈出一個「初始設定」視窗。
1. **選擇顯示語言**: 選擇您希望軟體介面顯示的語言。
2. **選擇預設正面/背面語言**: 設定您最常用的來源語言（正面）和目標語言（背面）。這將在後續操作中為您自動選擇語言，提高效率。
設定完成後，點擊「繼續」即可進入主介面。

## 介面概覽
軟體主介面分為三個主要部分：
1. **左側 - 功能選項卡**:
    - **下載音訊/影片和字幕**: 從網路 URL 下載素材。
    - **產生 Anki 包**: 使用本地或下載的素材產生卡片。
    - **利用 CSV 產生卡片**: 從一個 `.csv` 檔案批次產生卡片。
    - **設定**: 對軟體的預設行為和 Anki 範本進行設定。
2. **右側 - 日誌視窗**: 顯示軟體執行過程中的所有資訊、警告和錯誤。
3. **底部 - 進度條**: 顯示下載或產生過程的進度。

## 使用步驟

### 第一步：下載音訊/影片和字幕
此選項卡用於從線上影片取得製作卡片所需的素材。但請注意，影片或者音訊中最好是只有單一類語言，比如純中文或者純日文，不要使用同時包含多種語言的影片或者音訊。比如先讀中文，再讀日文的影片，就不太合適。後續再看是否需要提供這類功能。

1. **影片 URL**: 貼上一個 YouTube 影片連結。軟體會自動偵測剪貼簿中的有效連結並填入。通常為單一檔案影片，不能是列表或者個人影片頁面（這會導致無法正確下載或者下載過多檔案）。預設僅支援 Youtube 影片。如果想使用其他網站上的影片，請將 URL 輸入框後的勾選框選中，表示不檢查 URL 格式，則可以下載 yt-dlp 支援的任何網站的音訊/影片和字幕（結果請自行確認）。
2. **查詢語言**: 點擊此按鈕，軟體將開始分析 URL，取得所有可用的影片/音訊格式和字幕語言。
3. **下載目錄**: 選擇您希望儲存下載檔案的資料夾。
4. **音訊/影片格式**: 從下拉式清單中選擇一個格式。推薦選擇包含音訊和影片的 `mp4` 格式，或純音訊的 `m4a` 格式。
5. **正面/背面字幕語言**: 分別選擇卡片正面和背面想要使用的字幕語言。軟體會根據您的「設定」自動嘗試選擇預設語言。
6. **僅下載字幕**: 如果您本地已有影片檔案，或者不想產生截圖及原始音訊，可以勾選此項，只下載字幕檔案。
7. **開始下載**: 點擊後開始下載。完成後，軟體會提示您是否將下載好的檔案路徑自動填入到「產生 Anki 包」選項卡。建議選擇「是」。

### 第二步：產生 Anki 卡片包
此選項卡是核心功能所在，用於將素材組合成 Anki 卡片。

1. **檔案路徑設定**: 
    - **媒體檔案(可選)**: 選擇您的影片或音訊檔案。如果您想從影片中提取音訊和截圖，此項為必填。
    - **正面/背面字幕檔案**: 選擇兩種語言的字幕檔案 (`.srt` 或 `.vtt` 格式)。
    - **輸出目錄**: 選擇產生的 Anki 包 (`.apkg`) 和臨時檔案的存放位置（如果目錄不存在，會自動建立）。
    - **Anki 包名稱**: 為您的 Anki 卡片包命名，預設與正面字幕檔案名一樣。

2. **主要選項**:
    - **截圖選項**:
        - `新增截圖`: 勾選後會為每張卡片產生截圖。
        - `截圖時間點`: 選擇在字幕的開始、中間還是結尾進行截圖。
        - `品質`: 截圖品質，1-31 之間，數字越小品質越高（檔案也越大）。
    - **TTS 引擎**: 當沒有媒體檔案或提取音訊失敗時，使用哪個引擎產生語音。`gTTS` 需要連接 Google 服務，請自行確認是否可用。 和 `edge-tts` 都是不錯的選擇。`不產生 MP3` 則禁用此功能。其中 `gTTS` 需要連接 Google 服務，請自行確認是否可用。
    - **慢速語音**: 勾選後，gTTS 會以較慢的語速產生語音（edge-tts 不支援）。
    - **字幕清理**: 勾選 `移除...非對話內容` 會自動刪除字幕中如 `[音樂]`、`(掌聲)` 等內容。
    - **注音選項**: 勾選後會為正面或背面的中/日/韓文新增注音。
    - **後期處理**:
        - `清理 .mp3/.jpg/.csv 檔案`: 勾選後，在 Anki 包成功產生後，會自動刪除過程中產生的臨時音訊、截圖和資料檔案。
    - **時間軸偏移(ms)**: 如果音訊和字幕有固定的延遲，在此輸入毫秒數進行校正（正數使音訊提前，負數使音訊延遲）。
    - **字幕時間段**: 如果您只想製作影片中某一部分的卡片，在此輸入開始和結束時間 (格式 `HH:MM:SS`)。
    - **字幕合併**:
        - `合併時間接近的字幕行`: 勾選後，會將時間間隔很近的短字幕合併成一句，適合處理對話密集的影片。謹慎使用該功能，目前尚不成熟，僅對那些間隔時間比較隨意的 podcast 類媒體可以嘗試。
        - `最大間隔(ms)`: 定義多近的字幕可以被合併。
    - **檔案處理**:
        - `覆蓋同名 Anki 包`: 勾選後，如果輸出目錄中已存在同名檔案，會直接覆蓋。

3. **產生與預覽**:
    - **預覽前 5 張卡片**: 在不產生完整包的情況下，快速產生一個 HTML 檔案，在瀏覽器中預覽前 5 張卡片的效果。預覽中不包含音訊和預覽圖。
    - **產生 Anki 包**: 點擊開始最終的產生過程。

### 可選：從 CSV 檔案產生
如果您已經有整理好的雙語對照文字，可以使用此功能快速製卡。

1. **準備 CSV 檔案**: 建立一個 `.csv` 檔案，**第一欄**為卡片正面文字，**第二欄**為卡片背面文字。必須使用 UTF-8 編碼。如果需要 tts 產生語音，請不要新增注音等內容。
2. **CSV 檔案**: 在軟體中選擇您準備好的 CSV 檔案。
3. **設定選項**: 與「產生 Anki 包」選項卡類似，您可以設定輸出目錄、包名稱、TTS 引擎和注音選項。請保證選中的正面和背面語言與 CSV 檔案保持一致，否則會導致發音不正確。
4. **產生 Anki 包**: 點擊按鈕開始產生。此模式下不會有音訊提取和截圖功能，音訊將完全依賴 TTS 產生。

## 設定選項卡
在這裡您可以自訂軟體的預設行為和卡片外觀。

- **預設正面/背面字幕語言**: 設定您最常用的語言，軟體會在「下載」和「自動填入」時優先使用它們。
- **Anki 範本和樣式**:
    - **正面/背面範本**: 使用 Anki 的範本語法（如 `{{Question}}`, `{{Audio_Answer}}`）自訂卡片正反面的佈局。
    - **樣式表**: 使用 CSS 程式碼自訂卡片的字型、顏色、背景等外觀。
- **預覽 HTML 範本**: 自訂點擊「預覽」按鈕時產生的 HTML 檔案的基礎結構。一般不建議修改。
- **儲存與恢復**:
    - `儲存設定`: 儲存您對以上所有設定的更改。
    - `恢復設定`: 撤銷更改，恢復到上次儲存的狀態。

## 常見問題 (FAQ)
1. **問：軟體提示 "FFmpeg not found" (未找到 FFmpeg) 怎麼辦？**
    答：您需要從 FFmpeg 官方網站 下載它，解壓縮後，將其 `bin` 目錄的完整路徑新增到您作業系統的環境變數 `PATH` 中，然後重新啟動本軟體。

2. **問：為什麼我貼上的 YouTube 連結提示無效？**
    答：本工具目前只支援單一影片的 URL，不支援播放清單 (Playlist) 的 URL。請確保您的連結中不包含 `list=` 參數。如果您確認想使用其他網站影片或者把軟體當作一個 yt-dlp 的 UI，那麼請把 URL 地址後面的勾選項選中，強制去除 URL 的檢查。

3. **問：注音功能支援哪些語言？**
    答：目前支援為日語新增假名、為中文新增拼音、為韓語新增羅馬音。軟體會根據您選擇的字幕檔案名或設定中的預設語言自動判斷。

4. **問：gTTS 和 edge-tts 有什麼區別？**
    答：兩者都是文字轉語音引擎。gTTS (Google Text-to-Speech) 速度可能稍慢，但支援慢速播放。edge-tts (Microsoft Edge Text-to-Speech) 的語音通常更自然、品質更高，但不支持慢速播放。您可以根據需要選擇。如果一個引擎失敗，軟體會自動嘗試另一個。

5. **問：使用 YouTube 自動化字幕產生 ANKI 包是否有問題？**
    答：這點不好確定。因為自動化的字幕，其中的斷句可能存在很多問題，導致產生的語音和截取的語音都可以存在問題，所以不是非常建議使用自動化字幕，盡可能使用建立者提供的字幕。